import{F as e}from"./Form-7bd7b6f3.js";import{d as a,b as s,l as o,u as t,v as r,q as l,r as i,W as n,s as d,o as m,g as p,w as u,e as c,t as f,a as g,f as v,m as w,j,E as h}from"./index-61faf58b.js";import{E as b}from"./el-button-e6441f40.js";import{E as _}from"./tsxHelper-98042daf.js";import{u as y}from"./useForm-e3b0495d.js";import{l as R,a as x,b as k}from"./index-4154bb8a.js";import{u as P}from"./useValidator-03bda066.js";import{s as F}from"./index-2a08eed2.js";import{_ as I}from"./_plugin-vue_export-helper-1b428a4d.js";import"./el-col-0b4bbd49.js";import"./el-popper-e10402a6.js";import"./index-f844f20d.js";import"./el-input-dc0bf57b.js";import"./event-5568c9d8.js";import"./el-tag-450bf357.js";import"./el-input-number-b68dff77.js";import"./index-7630a328.js";import"./el-switch-3796832a.js";import"./validator-9877d78c.js";import"./el-divider-30a44c9a.js";import"./InputPassword-6a9b1358.js";import"./style.css_vue_type_style_index_0_src_true_lang-cd9eff14.js";import"./debounce-7bd0410d.js";import"./aria-ecee1d93.js";import"./scroll-a2507849.js";const D={class:"text-2xl font-bold text-center w-[100%]"},E={class:"flex justify-between items-center w-[100%]"},q={class:"w-[100%]"},A=I(a({__name:"LoginForm",emits:["to-register"],setup(a,{emit:I}){const{required:A}=P(),C=s(),V=o(),{currentRoute:z,addRoute:S,push:N}=t(),{wsCache:U}=r(),{t:W}=j(),H={username:[A()],password:[A()]},L=l([{field:"title",colProps:{span:24}},{field:"username",label:W("login.username"),value:"",component:"Input",colProps:{span:24},componentProps:{placeholder:W("login.usernamePlaceholder")}},{field:"password",label:W("login.password"),value:"",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:W("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24}},{field:"login",colProps:{span:24}}]),$=i(!1),{register:B,elFormRef:G,methods:J}=y(),K=i(!1),M=i("");n((()=>z.value),(e=>{var a;M.value=null==(a=null==e?void 0:e.query)?void 0:a.redirect}),{immediate:!0});const O=i();d((()=>{$.value=U.get("remember"),$.value&&(e=>{var a,s;const o=null==(a=g(O))?void 0:a.getElFormRef();if(e)null==o||o.resetFields();else{const e=U.get("formData");null==(s=g(O))||s.setValues({username:e.username,password:e.password})}})(!1)}));const Q=async()=>{const e=g(G);await(null==e?void 0:e.validate((async e=>{if(e){K.value=!0;const{getFormData:e}=J,a=await e();try{const e=await R(a).catch((e=>{-101===e.response.data.errorCode?h.error("用户不存在"):-102===e.response.data.errorCode&&h.error("密码错误")}));if(null==e?void 0:e.data)if(U.set(C.getUserInfo,e.data),U.set("formData",a),U.set("remember",$.value),C.getDynamicRouter)T();else{await V.generateRoutes("none").catch((()=>{})),V.getAddRouters.forEach((e=>{S(e)})),V.setIsAddRouters(!0);const e=await F({pageNo:1,pageSize:10}).catch((()=>{})).finally((()=>{K.value=!1}));(null==e?void 0:e.data.length)?N({name:"workStationDetail",query:{workstationId:e.data[0].workstationId}}):N({name:"WorkStationAdd"})}}finally{K.value=!1}}})))},T=async()=>{const{getFormData:e}=J,a=await e(),s={roleName:a.username},o="admin"===a.username?await x(s):await k(s);if(o){const{wsCache:e}=r(),s=o.data||[];e.set("roleRouters",s),"iweb"===a.username?await V.generateRoutes("admin",s).catch((()=>{})):await V.generateRoutes("test",s).catch((()=>{})),V.getAddRouters.forEach((e=>{S(e)})),V.setIsAddRouters(!0),N({path:M.value||V.addRouters[0].path})}};return(a,s)=>(m(),p(g(e),{schema:L,rules:H,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:g(B),ref_key:"formRef",ref:O},{title:u((()=>[c("h2",D,f(g(W)("login.login")),1)])),tool:u((()=>[c("div",E,[v(g(_),{modelValue:$.value,"onUpdate:modelValue":s[0]||(s[0]=e=>$.value=e),label:g(W)("login.remember"),size:"small"},null,8,["modelValue","label"])])])),login:u((()=>[c("div",q,[v(g(b),{loading:K.value,type:"primary",class:"w-[100%]",onClick:Q},{default:u((()=>[w(f(g(W)("login.login")),1)])),_:1},8,["loading"])])])),_:1},8,["schema","onRegister"]))}}),[["__scopeId","data-v-a8aaff35"]]);export{A as default};
