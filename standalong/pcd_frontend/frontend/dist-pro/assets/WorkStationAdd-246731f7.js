import{F as e}from"./Form-7bd7b6f3.js";import{_ as s}from"./ContentWrap.vue_vue_type_script_setup_true_lang-e04d0b7e.js";import{d as r,u as o,r as t,q as a,s as i,o as l,g as n,w as d,f as m,a as p,m as u,t as c,j,E as v}from"./index-61faf58b.js";import{u as f}from"./useValidator-03bda066.js";import{E as _}from"./el-button-e6441f40.js";import{u as y}from"./useForm-e3b0495d.js";import{b as w,c as g,d as h}from"./index-2a08eed2.js";import{r as k}from"./index-218e5d70.js";import{d as I}from"./index-ea2c32ca.js";import{_ as x}from"./_plugin-vue_export-helper-1b428a4d.js";import"./el-col-0b4bbd49.js";import"./el-popper-e10402a6.js";import"./index-f844f20d.js";import"./el-input-dc0bf57b.js";import"./event-5568c9d8.js";import"./el-tag-450bf357.js";import"./tsxHelper-98042daf.js";import"./index-7630a328.js";import"./scroll-a2507849.js";import"./debounce-7bd0410d.js";import"./validator-9877d78c.js";import"./el-input-number-b68dff77.js";import"./el-switch-3796832a.js";import"./el-divider-30a44c9a.js";import"./InputPassword-6a9b1358.js";import"./style.css_vue_type_style_index_0_src_true_lang-cd9eff14.js";import"./aria-ecee1d93.js";import"./el-card-839bb50e.js";import"./index-4154bb8a.js";const b=x(r({__name:"WorkStationAdd",setup(r){const{required:x}=f(),{t:b}=j(),{push:C,currentRoute:F}=o(),R=t(!1),P=F.value.query,$=a([{field:"workstationName",label:b("工作站名称"),component:"Input",formItemProps:{rules:[x()]},colProps:{span:13},componentProps:{style:{width:"100%"},placeholder:b("请输入工作站名称")}}]),{register:q,elFormRef:E,methods:O}=y(),A=async()=>{const e=p(E);await(null==e?void 0:e.validate((async e=>{if(e){R.value=!0;const{getFormData:e}=O,s=await e();Object.keys(P).length?V(s):N(s)}})))},N=async e=>{const s=await w(e).catch((e=>{-1111===e.response.data.errorCode&&v.error("工作站已存在")})).finally((()=>{R.value=!1})),r=t();s&&s.success&&(r.value=s.data.workstationId,R.value=!1);const o=t(),a=await k({roomName:"1号房间"},r.value).catch((e=>{-1113===e.response.data.errorCode?v.error("房间已存在"):-1115===e.response.data.errorCode&&v.error("房间创建失败")})).finally((()=>{R.value=!1}));(null==a?void 0:a.success)&&(R.value=!1,o.value=a.data.roomId);const i={workstationId:r.value,roomId:o.value},l=await I({macAddress:"",deviceType:"container"},i).catch((e=>{-1117===e.response.data.errorCode?v.error("设备已存在"):-104===e.response.data.errorCode?v.error("设备格式不正确"):-1119===e.response.data.errorCode&&v.error("设备绑定失败")})).finally((()=>{R.value=!1}));(null==l?void 0:l.success)&&C(`/work-station/device-add?workstationId=${r.value}&roomId=${null==a?void 0:a.data.roomId}`)},V=async e=>{const s=await g(e,{workstationId:P.workstationId}).catch((e=>{})).finally((()=>{R.value=!1}));s&&s.success&&C("/work-station/list")},W=t(),D=(e,s)=>{var r,o;const t=null==(r=p(W))?void 0:r.getElFormRef();e?null==t||t.resetFields():null==(o=p(W))||o.setValues(s)};return i((()=>{Object.keys(P).length&&(async e=>{const s=await h({username:e.username});s.success&&D(!1,s.data[0])})(P)})),(r,o)=>(l(),n(p(s),{title:`${p(b)(Object.keys(p(P)).length?"编辑工作站":"新增工作站")}`},{default:d((()=>[m(p(e),{isCustom:!1,schema:$,ref_key:"formRef",ref:W,onRegister:p(q)},null,8,["schema","onRegister"]),m(p(_),{loading:R.value,type:"primary",class:"w-[10%]",onClick:A},{default:d((()=>[u(c(p(b)("提交")),1)])),_:1},8,["loading"])])),_:1},8,["title"]))}}),[["__scopeId","data-v-6e4ba124"]]);export{b as default};
